{% extends "base.html" %}

{% load endless %}
{% load static from staticfiles %}
{% load app_filters %}
{% block section_class %}not-container{% endblock %}

{% block content %}
        {% with page="view" %}
            {% include "persona_builder/persona/intro.html" %}
        {% endwith %}

            <p></p>
            <h3 class="header-extra-small">Description</h3>
            <p>
                {% if persona.description %}
                    {{ persona.description }}
                {% else %}
                    No persona description
                {% endif %}
            </p>

            {% include "persona_builder/persona/stats.html" %}

            <div class="clearfix">
                <em>{{ persona|count_users }} users matching this profile:</em>
                <form action="{{ persona.get_absolute_url }}update-users/" method="POST" class="pull-right">
                    {% csrf_token %}
                    <input type="submit" class="btn btn-refresh" value="Refresh users" />
                </form>
            </div>

            {% if not users %}
                <div id="persona-processing">
                    Fetching customers... <i class="fa fa-spin fa-spinner"></i>
                </div>
            {% else %}
                {% include "persona_builder/persona/users.html" %}
            {% endif %}
        </div>
    </section>
{% endblock %}

{% block js %}
    <script src="{% static "persona_builder/js/amcharts/amcharts.js" %}"></script>
    <script src="{% static "persona_builder/js/amcharts/pie.js" %}"></script>
    <script src="{% static "persona_builder/js/amcharts/themes/light.js" %}"></script>

    <script src="{% static "persona_builder/js/render_stats.js" %}"></script>
    <script src="{% static "persona_builder/js/load-users.js" %}"></script>
{% endblock %}