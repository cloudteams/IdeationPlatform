{% extends "base.html" %}

{% load static from staticfiles %}
{% load app_filters %}

{% block content %}
    <div class="btn-group pull-right">
        <a href="/persona-builder/personas/" class="btn btn-default">Back to Persona Pool</a>
        <a href="{{persona.get_edit_properties_url}}" class="btn btn-default">Edit persona</a>
        <a href="{{persona.get_absolute_url}}delete/" class="btn btn-danger">Delete</a>
    </div>

    {% include "persona_builder/persona/teaser.html" %}

    <div class="clearfix">
        <em>Users matching this profile:</em>
        <form action="{{persona.get_absolute_url}}update-users/" method="POST" class="pull-right">
            {% csrf_token %}
            <input type="submit" class="btn btn-primary" value="Refresh users" />
        </form>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                {% for property in properties %}
                    <th>{{property.label}}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    {% for property in properties %}
                        {% if not property.is_pk %}
                            {% with p_key=property.name %}
                                {% with value=user|get_property:p_key %}
                                    <td>{{value|pretty_print}}</td>
                                {% endwith %}
                            {% endwith %}
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}